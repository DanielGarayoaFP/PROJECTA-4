[T02_ DPR_ còpies de seguretat.md](https://github.com/user-attachments/files/24129003/T02_.DPR_.copies.de.seguretat.md)# Guia Tècnica: Còpia de Seguretat del Perfil d’Usuari a Windows 11 amb Duplicati (FASE 1)
---
## 1. Introducció

Aquesta guia tècnica detalla el procediment per implantar una política de còpies de seguretat segons l’esquema 3-2-1 per a l’equip Windows del director de l’empresa. Es realitzaran còpies locals al disc secundari de l’equip i còpies al núvol (Google Drive) mitjançant l’eina Duplicati.

L’objectiu és assegurar la disponibilitat i integritat de la informació crítica emmagatzemada al perfil de l’usuari, especialment a la carpeta Documents, i validar la capacitat de restauració en cas de pèrdua accidental.

---
## 2. Requisits previs

- Màquina virtual amb Windows 11.
  - Dos discs durs:
  - Disc primari: sistema operatiu.
  - Disc secundari: 10 GB.
  - Compte personal de Google (no escolar) amb accés a Google Drive.
  - Compte d’usuari local.
  - Accés a Internet per a la instal·lació de Duplicati i la sincronització amb el núvol.

<img width="862" height="503" alt="image" src="https://github.com/user-attachments/assets/1fa8cd73-b1b0-4998-ad88-0da9009dde1e" />

## 3. Instal·lació de Duplicati

- 1-Accedeix a la pàgina oficial: https://www.duplicati.com/download.
- 2-Descarrega la versió estable per a Windows.
- 3-Executa el fitxer i segueix l’assistent d’instal·lació:
  - Accepta els termes de llicència.
  - Selecciona "Install for all users".
  - Marca l’opció "Start Duplicati automatically when Windows starts".
- Un cop finalitzada la instal·lació, Duplicati s’executarà com a servei i obrirà
- 
[Uploading T02#


**T02: DPR: còpies de seguretat. Cas pràctic**

|

# **Còpies de seguretat en Windows 11 amb Duplicati**

## **1\. Preparació de la màquina virtual**

Crear una màquina virtual Windows 11\.

Afegir:

* Disc principal → Sistema operatiu

  * Disc secundari → **10 GB**, mode **SATA** o **SCSI**

Un cop dins de Windows:

* Obrir *Disk Management* → inicialitzar el disc → crear partició NTFS i assignar lletra (ex: E:).


<img width="597" height="339" alt="image" src="https://github.com/user-attachments/assets/a19e9225-0c91-4cd0-aa95-cbacb8656bf7" />


## 

## 

## **Instal·lació de Duplicati**

Baixa Duplicati des de la web oficial.  
<img width="132" height="35" alt="image" src="https://github.com/user-attachments/assets/cddfb1fc-4158-4312-ba46-7d08b3959aa9" />


Instal·la com a "Typical".  

<img width="463" height="235" alt="image" src="https://github.com/user-attachments/assets/c937b79e-5779-4a6a-9eff-c5180574464a" />


En finalitzar, s'obrirà a la barra del sistema → clic dret → **Open**.

<img width="529" height="216" alt="image" src="https://github.com/user-attachments/assets/20110ab7-7ebe-4d02-9f58-64bff3726df9" />


## **3\. Creació del pla de còpia LOCAL (cada hora)**

### **3.1 Crear un bucket local (destinació)**

1. A Duplicati → *Add backup*.  

<img width="311" height="93" alt="image" src="https://github.com/user-attachments/assets/1da9a4b5-d052-4aab-8adf-d2e3b0da0682" />


2. Selecciona **Configure a new backup**.  

<img width="240" height="286" alt="image" src="https://github.com/user-attachments/assets/ae208905-d479-4ace-a054-33a66847b5f3" />

   Paràmetres:

**Name**: Backup local perfil  
**Encryption**: AES-256 \+ contrasenya

3. Destinació:  
4. **Storage type**: Local folder

   <img width="294" height="110" alt="image" src="https://github.com/user-attachments/assets/c675594b-0104-47d8-bdec-4381cbaacaf1" />


   * Folder: `E:\backup-windows`  
     

     

Selecció de fitxers:

Carpeta del perfil:

 `C:\Users\NomUsuari\`

*   
5. Programació:

   * **Every 1 hour**

  <img width="456" height="274" alt="image" src="https://github.com/user-attachments/assets/1b039f22-7cc5-4d30-ba8c-b73a76788e55" />

## **4\. Creació del pla de còpia al CLOUD (18:00)**

### **4.1 Preparar Google Drive**

* Crear un compte Google no vinculat a l’escola.  

<img width="394" height="90" alt="image" src="https://github.com/user-attachments/assets/250b0c3d-c35f-4d26-968a-ea25a40e56b5" />



* A Duplicati, seleccionar **Storage type → Google Drive**.

* Autoritzar via navegador i permetre l’accés.

Fitxers a copiar: Igual que el backup local.

Programació:

* **Time → 18:00 cada dia**

<img width="336" height="205" alt="image" src="https://github.com/user-attachments/assets/7dd992f0-50c0-4401-b34e-4757fc032efb" />


## **5\. Proves de funcionament**

### **5.1 Afegir arxius**

* Crear fitxers a *Documents* i altres carpetes del perfil.  
    
 <img width="509" height="166" alt="image" src="https://github.com/user-attachments/assets/3d9e4b0e-280c-4f38-bd5b-8f19cafc3d39" />


### **5.2 Verificar còpia local**

* Esperar una hora o forçar “Run now”.

* Revisar contingut de `E:\backup-windows`.

### **5.3 Restauració LOCAL**

1. Esborrar contingut de `C:\Users\NomUsuari\Documents`.

2. A Duplicati → *Restore* → seleccionar còpia local → recuperar.

### **5.4 Restauració des del CLOUD**

1. A *Restore* seleccionar Google Drive.

2. Triar versió i restaurar a local o a carpeta alternativa.
----------------------------------------------------------------------------------------------------------------------------------------------------

**Part 2: Còpia seguretat servidor Linux**

Afegim un disc nou amb el cual farem la copia de seguretat:

<img width="909" height="547" alt="image" src="https://github.com/user-attachments/assets/ecc47b17-80a4-4279-a044-e96baf510d69" />


Hem de fer un lsblk per saber les carpetes que tenim a la maquina:

<img width="366" height="227" alt="image" src="https://github.com/user-attachments/assets/6fcb7227-d649-41be-9044-62fe087211cf" />

Ara instalem xfsprogs:

<img width="472" height="152" alt="image" src="https://github.com/user-attachments/assets/2fbf489b-d52c-409c-9abd-8cd8ac84fdb4" />

Ara comprovem amb mkfs el sdb

<img width="655" height="321" alt="image" src="https://github.com/user-attachments/assets/d1a4d6cc-a40c-42b0-bcf8-6bb6a1959b61" />

Creem carpetes per el media sdb1

<img width="483" height="92" alt="image" src="https://github.com/user-attachments/assets/3e0c413d-31d4-476d-88c3-42efeca7d8b9" />

Ara fem df -h | grep backup per comprovar si s'ha creat correctament

<img width="437" height="72" alt="image" src="https://github.com/user-attachments/assets/472c235d-eb04-473d-825b-3c047fd30627" />

Comprovem amb duplicity

<img width="390" height="34" alt="image" src="https://github.com/user-attachments/assets/55d61eaa-1804-49a8-9890-e6840a1972df" />

Ara agregem un usuari1 
<img width="496" height="401" alt="image" src="https://github.com/user-attachments/assets/9a69deb4-7130-49e9-9d42-04db08453295" />

Comrpovem:
<img width="641" height="275" alt="image" src="https://github.com/user-attachments/assets/8af052eb-f9f2-4c73-be30-16820fb0e40f" />

Ara amb ls -lh  comprovem que s'ha creat correctament:
<img width="528" height="272" alt="image" src="https://github.com/user-attachments/assets/2bf92997-4f06-415e-aac0-1340d2a08707" />

ara fem un sudo duplicaty amb la comanda del directori:

<img width="628" height="435" alt="image" src="https://github.com/user-attachments/assets/20806343-228a-4433-875d-12550b5a2d0e" />

Fem ls i corretgim:

<img width="484" height="105" alt="image" src="https://github.com/user-attachments/assets/1e85bbed-c812-4478-b757-307084f4b2b3" />

Ara possem fixers a la maquina i amb ls comprovem:

<img width="479" height="91" alt="image" src="https://github.com/user-attachments/assets/e2f98166-85ea-481d-b5cc-b19724e7dc03" />

Ara ho comprovem:

<img width="652" height="205" alt="image" src="https://github.com/user-attachments/assets/e9f7be55-767f-42f5-9976-84aae91f0e6b" />

Fem copy i tornem a afegir-lo
<img width="572" height="280" alt="image" src="https://github.com/user-attachments/assets/a5d46590-4372-4c68-94b8-43e856a68f73" />

Ara fem un backup:

<img width="590" height="437" alt="image" src="https://github.com/user-attachments/assets/6416dc16-199e-4362-8159-aaff58395194" />

sudo duplicati per la administracio dell:
<img width="603" height="199" alt="image" src="https://github.com/user-attachments/assets/dc9438d6-9d31-404a-8488-fc66dda482fe" />

Ara automatitzarem tots aquest procesos amb un script.

sudo nano /root/fullbackup.sh
#!/bin/bash

mount /dev/sdb1 /media/backup

export PASSPHRASE="la_teva_contrasenya"

duplicity full /home file:///media/backup/home-backup

unset PASSPHRASE

umount /media/backup

<img width="585" height="339" alt="image" src="https://github.com/user-attachments/assets/78e2c1fb-7cc0-49e1-8d24-75f84daa48e9" />

Ara donem permisos d’execució a aquest script.

sudo chmod +x /root/fullbackup.sh
I el provem manualment

sudo /root/fullbackup.sh

<img width="370" height="272" alt="image" src="https://github.com/user-attachments/assets/33950ce4-c745-46d3-a625-8d0d795ef9ef" />

Si no dóna errors, està bé.​

Ara programarem l'execució amb cron.

sudo crontab -e
I afegim aquesta línea al final:

0 23 * * 0 /root/fullbackup.sh

<img width="558" height="279" alt="image" src="https://github.com/user-attachments/assets/3f0b7642-4089-487f-8342-9675b3e1670f" />

Guardem els canvis amb

sudo crontab -l

<img width="578" height="465" alt="image" src="https://github.com/user-attachments/assets/bd7f4dea-6d5a-4ca9-8a23-3b66a44402e5" />


Ara crearem un altre script que farà el mateix però fent una còpia incremental

sudo nano /root/incrementalbackup.sh

<img width="596" height="272" alt="image" src="https://github.com/user-attachments/assets/9216902f-9eca-447f-b9ab-cde0b2c46dc9" />

Desem i sortim

Donem permisos d’execució a l’script

sudo chmod +x /root/incrementalbackup.sh
El provem manualment

sudo /root/incrementalbackup.sh

<img width="543" height="386" alt="image" src="https://github.com/user-attachments/assets/c061dabf-75ee-4b04-833e-0a28d5d607b8" />


Ara afegim aquest script al cron també, tornem com a root a crontab

sudo crontab -e
A sota de la línia anterior, afegim:

0 23 * * 1-6 /root/incrementalbackup.sh

<img width="598" height="496" alt="image" src="https://github.com/user-attachments/assets/5e151f74-8fda-4c17-bf28-8191a6a75c2c" />

Desem els canvis

sudo crontab -l

<img width="590" height="553" alt="image" src="https://github.com/user-attachments/assets/49695b20-a76c-4d80-8096-0b7ed849cf41" />
